
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <title>Conditioning ¬∑ HonKit</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="HonKit 5.1.1">
        
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/@honkit/honkit-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="text_to_image.html" />
    
    
    <link rel="prev" href="stable_diffusion.html" />
    

    </head>
    <body>
        
<div class="book honkit-cloak">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../">
            
                <a href="../../">
            
                    
                    Syllabus
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Agenda</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="../../agenda/1-enter_the_latent_space.html">
            
                <a href="../../agenda/1-enter_the_latent_space.html">
            
                    
                    1 ‚Äì Enter the Latent Space üöÄ
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="../../agenda/2-image_generation.html">
            
                <a href="../../agenda/2-image_generation.html">
            
                    
                    2 ‚Äì Fundamentals of Image Generation ‚úçÔ∏è
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="../../agenda/3-refine_images.html">
            
                <a href="../../agenda/3-refine_images.html">
            
                    
                    3 ‚Äì Refine Images üé®
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.4" data-path="../../agenda/4-image_compositing.html">
            
                <a href="../../agenda/4-image_compositing.html">
            
                    
                    4 - Image Compositing üìê
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.5" data-path="../../agenda/5-ml_society.html">
            
                <a href="../../agenda/5-ml_society.html">
            
                    
                    5 ‚Äì Machine Learning & Society üíæ
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.6" data-path="../../agenda/6-final_presentations.html">
            
                <a href="../../agenda/6-final_presentations.html">
            
                    
                    6 ‚Äì Final Presentations ‚ú®
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Lectures</li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="./">
            
                <a href="./">
            
                    
                    1 ‚Äì Enter the Latent Space üöÄ
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1.1" data-path="machine_learning.html">
            
                <a href="machine_learning.html">
            
                    
                    Machine Learning
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.2" data-path="diffusion_models.html">
            
                <a href="diffusion_models.html">
            
                    
                    Diffusion Models
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.3" data-path="workflow.html">
            
                <a href="workflow.html">
            
                    
                    Workflow
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.4" data-path="stable_diffusion.html">
            
                <a href="stable_diffusion.html">
            
                    
                    Stable Diffusion
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="3.1.5" data-path="conditioning.html">
            
                <a href="conditioning.html">
            
                    
                    Conditioning
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.6" data-path="text_to_image.html">
            
                <a href="text_to_image.html">
            
                    
                    Text to Image
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.7" data-path="apps.html">
            
                <a href="apps.html">
            
                    
                    End-User Applications
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="../2-image_generation/">
            
                <a href="../2-image_generation/">
            
                    
                    2 ‚Äì Fundamentals to Image Generation ‚úçÔ∏è
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.2.1" data-path="../2-image_generation/prompt_engineering.html">
            
                <a href="../2-image_generation/prompt_engineering.html">
            
                    
                    Prompt Engineering
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2.2" data-path="../2-image_generation/parameters.html">
            
                <a href="../2-image_generation/parameters.html">
            
                    
                    Parameters
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.2.2.1" data-path="../2-image_generation/resolution.html">
            
                <a href="../2-image_generation/resolution.html">
            
                    
                    Resolution
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2.2.2" data-path="../2-image_generation/seed.html">
            
                <a href="../2-image_generation/seed.html">
            
                    
                    Seed
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2.2.3" data-path="../2-image_generation/batch.html">
            
                <a href="../2-image_generation/batch.html">
            
                    
                    Batch size
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2.2.4" data-path="../2-image_generation/samplers.html">
            
                <a href="../2-image_generation/samplers.html">
            
                    
                    Samplers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2.2.5" data-path="../2-image_generation/cfg.html">
            
                <a href="../2-image_generation/cfg.html">
            
                    
                    CFG scale
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.2.3" data-path="../2-image_generation/models.html">
            
                <a href="../2-image_generation/models.html">
            
                    
                    Models
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.2.3.1" data-path="../2-image_generation/checkpoint_models.html">
            
                <a href="../2-image_generation/checkpoint_models.html">
            
                    
                    Checkpoint Models
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2.3.2" data-path="../2-image_generation/fine_tuned_models.html">
            
                <a href="../2-image_generation/fine_tuned_models.html">
            
                    
                    Fine-Tuned Models
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2.3.3" data-path="../2-image_generation/advanced_control_models.html">
            
                <a href="../2-image_generation/advanced_control_models.html">
            
                    
                    Models for Advanced Control
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.3" data-path="../3-refine_images/">
            
                <a href="../3-refine_images/">
            
                    
                    3 ‚Äì Refine Images üé®
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.3.1" data-path="../3-refine_images/image_to_image.html">
            
                <a href="../3-refine_images/image_to_image.html">
            
                    
                    Image to Image
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3.2" data-path="../3-refine_images/inpainting.html">
            
                <a href="../3-refine_images/inpainting.html">
            
                    
                    Inpainting
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3.3" data-path="../3-refine_images/outpainting.html">
            
                <a href="../3-refine_images/outpainting.html">
            
                    
                    Outpainting
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3.4" data-path="../3-refine_images/upscaling.html">
            
                <a href="../3-refine_images/upscaling.html">
            
                    
                    Upscaling
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.4" data-path="../4-image_compositing/">
            
                <a href="../4-image_compositing/">
            
                    
                    4 - Image Compositing üìê
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.4.1" data-path="../4-image_compositing/depth_to_image.html">
            
                <a href="../4-image_compositing/depth_to_image.html">
            
                    
                    Depth to Image
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.5" data-path="../5-ml_society/">
            
                <a href="../5-ml_society/">
            
                    
                    5 ‚Äì Machine Learning & Society üíæ
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.5.1" data-path="../5-ml_society/model_training.html">
            
                <a href="../5-ml_society/model_training.html">
            
                    
                    Model Training
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.5.2" data-path="../5-ml_society/embedding.html">
            
                <a href="../5-ml_society/embedding.html">
            
                    
                    Embedding
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.6" data-path="../6-final_presentations/">
            
                <a href="../6-final_presentations/">
            
                    
                    6 ‚Äì Final Presentations ‚ú®
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Prompts</li>
        
        
    
        <li class="chapter " data-level="4.1" data-path="../../prompts/1-promptcraft.html">
            
                <a href="../../prompts/1-promptcraft.html">
            
                    
                    1 - Promptcraft challenge
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2" data-path="../../prompts/2-blurbs.html">
            
                <a href="../../prompts/2-blurbs.html">
            
                    
                    2 - Blurbs
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Resources</li>
        
        
    
        <li class="chapter " data-level="5.1" data-path="../../resources/readings.html">
            
                <a href="../../resources/readings.html">
            
                    
                    Readings
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.2" data-path="../../resources/apps.html">
            
                <a href="../../resources/apps.html">
            
                    
                    End-User Applications
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.3" data-path="../../resources/prompt_engineering.html">
            
                <a href="../../resources/prompt_engineering.html">
            
                    
                    Prompt Engineering
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.4" data-path="../../resources/models.html">
            
                <a href="../../resources/models.html">
            
                    
                    Models
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.5" data-path="../../resources/inpainting_outpainting.html">
            
                <a href="../../resources/inpainting_outpainting.html">
            
                    
                    Inpainting / Outpainting
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.6" data-path="../../resources/model_training.html">
            
                <a href="../../resources/model_training.html">
            
                    
                    Model Training
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.7" data-path="../../resources/community.html">
            
                <a href="../../resources/community.html">
            
                    
                    Community
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://github.com/honkit/honkit" target="blank" class="gitbook-link">
            Published with HonKit
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../.." >Conditioning</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="conditioning">Conditioning</h1>
<p>The purpose of conditioning is to steer the noise predictor so that the predicted noise will give us what we want after subtracting from the image.</p>
<h2 id="text-conditioning-text-to-image">Text conditioning (text-to-image)</h2>
<p>Below is an overview of how a text prompt is processed and fed into the noise predictor. Tokenizer first converts each word in the prompt to a number called a token. Each token is then converted to a vector called embedding. The embeddings are then processed by the text transformer and are ready to be consumed by the noise predictor.</p>
<p><br></p>
<p></p><figure>
  <img src="../../assets/lecture/andrew-wong-conditioning.png" width="500px">
  <figcaption style="color:grey; font-style: italic;">Credit: Andrew Wong, 2023, &quot;How does Stable Diffusion work?&quot;</figcaption>
</figure>
<br><p></p>
<h2 id="tokenizer">Tokenizer</h2>
<p>The text prompt is first tokenized by a CLIP tokenizer. CLIP is a deep learning model developed by Open AI to produce text descriptions of any images. Stable Diffusion v1 uses CLIP‚Äôs tokenizer.</p>
<p>Tokenization is the computer‚Äôs way of understanding words. We humans can read words, but computers can only read numbers. That‚Äôs why words in a text prompt are first converted to numbers.</p>
<h2 id="embedding">Embedding</h2>
<p>Embedding is a 768-value vector. Each token has its own unique embedding vector. Embedding is fixed by the CLIP model, which is learned during training.</p>
<p>Why do we need embedding? It‚Äôs because some words are closely related to each other. We want to take advantage of this information. For example, the embeddings of man, gentleman, and guy are nearly identical because they can be used interchangeably. Monet, Manet, and Degas all painted in impressionist styles but in different ways. The names have close but not identical embeddings.</p>
<p>Embedding can also be used to trigger a style with a keyword. We will discuss this in the section <a href="../5-ml_society/">4 - Model Training üíæ</a></p>
<h2 id="text-transformer">Text transformer</h2>
<p>The embedding needs to be further processed by the text transformer before feeding into the noise predictor. The output of the text transformer is used multiple times by the noise predictor. That‚Äôs where the prompt meets the image (cross-attention).</p>
<p>Let‚Äôs use the prompt ‚ÄúA man with blue eyes‚Äù as an example. Stable Diffusion pairs the two words ‚Äúblue‚Äù and ‚Äúeyes‚Äù together so that it generates a man with blue eyes but not a man with a blue shirt. It then uses this information to steer the reverse diffuse towards images containing blue eyes.</p>
<h2 id="other-conditionings">Other conditionings</h2>
<p>The text prompt is not the only way a Stable Diffusion model can be conditioned. ControlNet for instance conditions the noise predictor with detected outlines, human poses, etc, and achieves excellent controls over image generations. We will discuss this in the section <a href="../3-refine_images/">3 ‚Äì Image Compositing üìê</a></p>
<h2 id="references">References</h2>
<ul>
<li><a href="https://stable-diffusion-art.com/how-stable-diffusion-work/" target="_blank">Andrew Wong, 2023, &quot;How does Stable Diffusion work?&quot;, <em>Stable Diffusion Art</em></a></li>
</ul>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="stable_diffusion.html" class="navigation navigation-prev " aria-label="Previous page: Stable Diffusion">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="text_to_image.html" class="navigation navigation-next " aria-label="Next page: Text to Image">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Conditioning","level":"3.1.5","depth":2,"next":{"title":"Text to Image","level":"3.1.6","depth":2,"path":"lectures/1-enter_the_latent_space/text_to_image.md","ref":"lectures/1-enter_the_latent_space/text_to_image.md","articles":[]},"previous":{"title":"Stable Diffusion","level":"3.1.4","depth":2,"path":"lectures/1-enter_the_latent_space/stable_diffusion.md","ref":"lectures/1-enter_the_latent_space/stable_diffusion.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":[],"pluginsConfig":{"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56},"embedFonts":false},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"lectures/1-enter_the_latent_space/conditioning.md","mtime":"2023-11-02T19:55:45.245Z","type":"markdown"},"gitbook":{"version":"5.1.1","time":"2023-11-10T13:12:28.761Z"},"basePath":"../..","book":{"language":""}});
        });
    </script>
</div>

        
    <noscript>
        <style>
            .honkit-cloak {
                display: block !important;
            }
        </style>
    </noscript>
    <script>
        // Restore sidebar state as critical path for prevent layout shift
        function __init__getSidebarState(defaultValue){
            var baseKey = "";
            var key = baseKey + ":sidebar";
            try {
                var value = localStorage[key];
                if (value === undefined) {
                    return defaultValue;
                }
                var parsed = JSON.parse(value);
                return parsed == null ? defaultValue : parsed;
            } catch (e) {
                return defaultValue;
            }
        }
        function __init__restoreLastSidebarState() {
            var isMobile = window.matchMedia("(max-width: 600px)").matches;
            if (isMobile) {
                // Init last state if not mobile
                return;
            }
            var sidebarState = __init__getSidebarState(true);
            var book = document.querySelector(".book");
            // Show sidebar if it enabled
            if (sidebarState && book) {
                book.classList.add("without-animation", "with-summary");
            }
        }

        try {
            __init__restoreLastSidebarState();
        } finally {
            var book = document.querySelector(".book");
            book.classList.remove("honkit-cloak");
        }
    </script>
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="../../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

