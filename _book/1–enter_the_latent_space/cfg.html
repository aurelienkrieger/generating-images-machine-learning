
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <title>CFG scale ¬∑ HonKit</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="HonKit 5.1.1">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/@honkit/honkit-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="prompt_engineering.html" />
    
    
    <link rel="prev" href="text_to_image.html" />
    

    </head>
    <body>
        
<div class="book honkit-cloak">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Lectures</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="./">
            
                <a href="./">
            
                    
                    1 ‚Äì Enter the Latent Space üöÄ
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1.1" data-path="machine_learning.html">
            
                <a href="machine_learning.html">
            
                    
                    What is Machine Learning
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.2" data-path="workflow.html">
            
                <a href="workflow.html">
            
                    
                    Workflow
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.3" data-path="stable_diffusion.html">
            
                <a href="stable_diffusion.html">
            
                    
                    What is Stable Diffusion
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.4" data-path="conditioning.html">
            
                <a href="conditioning.html">
            
                    
                    Conditioning
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.5" data-path="text_to_image.html">
            
                <a href="text_to_image.html">
            
                    
                    Text to Image
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="2.1.6" data-path="cfg.html">
            
                <a href="cfg.html">
            
                    
                    CFG scale
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.7" data-path="prompt_engineering.html">
            
                <a href="prompt_engineering.html">
            
                    
                    Prompt Engineering
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="../2‚Äìrefine_images/">
            
                <a href="../2‚Äìrefine_images/">
            
                    
                    2 ‚Äì Refine Images üé®
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.2.1" data-path="../2‚Äìrefine_images/models.html">
            
                <a href="../2‚Äìrefine_images/models.html">
            
                    
                    Models
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.2" data-path="../2‚Äìrefine_images/checkpoint_models.html">
            
                <a href="../2‚Äìrefine_images/checkpoint_models.html">
            
                    
                    Checkpoint Models
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.3" data-path="../2‚Äìrefine_images/custom_models.html">
            
                <a href="../2‚Äìrefine_images/custom_models.html">
            
                    
                    Custom Models
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.4" data-path="../2‚Äìrefine_images/inpainting.html">
            
                <a href="../2‚Äìrefine_images/inpainting.html">
            
                    
                    Inpainting
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.5" data-path="../2‚Äìrefine_images/outpainting.html">
            
                <a href="../2‚Äìrefine_images/outpainting.html">
            
                    
                    Outpainting
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="../3‚Äìimage_compositing/">
            
                <a href="../3‚Äìimage_compositing/">
            
                    
                    3 ‚Äì Image Compositing üìê
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.3.1" data-path="../3‚Äìimage_compositing/image_to_image.html">
            
                <a href="../3‚Äìimage_compositing/image_to_image.html">
            
                    
                    Image to Image
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3.2" data-path="../3‚Äìimage_compositing/inpainting.html">
            
                <a href="../3‚Äìimage_compositing/inpainting.html">
            
                    
                    Inpainting
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3.3" data-path="../3‚Äìimage_compositing/depth_to_image.html">
            
                <a href="../3‚Äìimage_compositing/depth_to_image.html">
            
                    
                    Depth to Image
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.4" data-path="../4-model_training/">
            
                <a href="../4-model_training/">
            
                    
                    4 - Model Training üíæ
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.4.1" data-path="../4-model_training/model_training.html">
            
                <a href="../4-model_training/model_training.html">
            
                    
                    Model Training
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.4.2" data-path="../4-model_training/embedding.html">
            
                <a href="../4-model_training/embedding.html">
            
                    
                    Embedding
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.5" data-path="../5‚Äìextra_tips_animations/">
            
                <a href="../5‚Äìextra_tips_animations/">
            
                    
                    5 ‚Äì Extra tips & Animations üé•
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.6" data-path="../6‚Äìfinal_presentations/">
            
                <a href="../6‚Äìfinal_presentations/">
            
                    
                    6 ‚Äì Final Presentations ‚ú®
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Resources</li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="../resources/articles.html">
            
                <a href="../resources/articles.html">
            
                    
                    Articles
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="../resources/tools.html">
            
                <a href="../resources/tools.html">
            
                    
                    Tools
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3" data-path="../resources/prompt_engineering.html">
            
                <a href="../resources/prompt_engineering.html">
            
                    
                    Prompt Engineering
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.4" data-path="../resources/models.html">
            
                <a href="../resources/models.html">
            
                    
                    Models
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.5" data-path="../resources/inpainting_outpainting.html">
            
                <a href="../resources/inpainting_outpainting.html">
            
                    
                    Inpainting / Outpainting
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.6" data-path="../resources/model_training.html">
            
                <a href="../resources/model_training.html">
            
                    
                    Model Training
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://github.com/honkit/honkit" target="blank" class="gitbook-link">
            Published with HonKit
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >CFG scale</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="what-is-the-cfg-value">What is the CFG value?</h1>
<h2 id="classifier-guidance">Classifier guidance</h2>
<p>Classifier guidance is a way to incorporate image labels in diffusion models. You can use a label to guide the diffusion process. For example, the label ‚Äúcat‚Äù steers the reverse diffusion process to generate photos of cats.</p>
<p>The classifier guidance scale is a parameter for controlling how closely should the diffusion process follow the label.</p>
<p>Below is an example I stole from this paper. Suppose there are 3 groups of images with labels ‚Äúcat‚Äù, ‚Äúdog‚Äù, and ‚Äúhuman‚Äù. If the diffusion is unguided, the model will draw samples from each group‚Äôs total population, but sometimes it may draw images that could fit two labels, e.g. a boy petting a dog.</p>
<p><img src="https://stable-diffusion-art.com/wp-content/uploads/2022/12/image-106.png" width="400px"></p>
<p><br>Left: unguided. Middle: small guidance scale. Right: large guidance scale.</p>
<p>With high classifier guidance, the images produced by the diffusion model would be biased toward the extreme or unambiguous examples. If you ask the model for a cat, it will return an image that is unambiguously a cat and nothing else.</p>
<p>The classifier guidance scale controls how closely the guidance is followed. In the figure above, the sampling on the right has a higher classifier guidance scale than the one in the middle. In practice, this scale value is simply the multiplier to the drift term toward the data with that label.</p>
<h2 id="classifier-free-guidance">Classifier-free guidance</h2>
<p>Although classifier guidance achieved record-breaking performance, it needs an extra model to provide that guidance. This has presented some difficulties in training.</p>
<p>Classifier-free guidance, in its authors‚Äô terms, is a way to achieve ‚Äúclassifier guidance without a classifier‚Äù. Instead of using class labels and a separate model for guidance, they proposed to use image captions and train a conditional diffusion model, exactly like the one we discussed in text-to-image.</p>
<p>They put the classifier part as conditioning of the noise predictor U-Net, achieving the so-called ‚Äúclassifier-free‚Äù (i.e. without a separate image classifier) guidance in image generation.</p>
<p>The text prompt provides this guidance in text-to-image.</p>
<h2 id="classifier-free-guidance-scale">Classifier-free guidance scale</h2>
<p>Now we have a classifier-free diffusion process using conditioning. How do we control how much the AI-generated images should follow the guidance?</p>
<p>Classifier-free guidance scale (CFG scale) is a value that controls how much the text prompt steers the diffusion process. The AI image generation is unconditioned (i.e. the prompt is ignored) when the CFG scale is set to 0. A higher CFG scale steers the diffusion towards the prompt.</p>
<h2 id="references">References</h2>
<ul>
<li><a href="https://stable-diffusion-art.com/how-stable-diffusion-work/" target="_blank">Andrew Wong, 2023, &quot;How does Stable Diffusion work?&quot;, <em>Stable Diffusion Art</em></a></li>
<li><a href="https://arxiv.org/abs/2207.12598" target="_blank">Jonathan Ho, Tim Salimans, 2022, &quot;Classifier-Free Diffusion Guidance&quot;</a></li>
</ul>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="text_to_image.html" class="navigation navigation-prev " aria-label="Previous page: Text to Image">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="prompt_engineering.html" class="navigation navigation-next " aria-label="Next page: Prompt Engineering">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"CFG scale","level":"2.1.6","depth":2,"next":{"title":"Prompt Engineering","level":"2.1.7","depth":2,"path":"1‚Äìenter_the_latent_space/prompt_engineering.md","ref":"1‚Äìenter_the_latent_space/prompt_engineering.md","articles":[]},"previous":{"title":"Text to Image","level":"2.1.5","depth":2,"path":"1‚Äìenter_the_latent_space/text_to_image.md","ref":"1‚Äìenter_the_latent_space/text_to_image.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["livereload"],"pluginsConfig":{"livereload":{},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56},"embedFonts":false},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"1‚Äìenter_the_latent_space/cfg.md","mtime":"2023-10-18T20:39:00.944Z","type":"markdown"},"gitbook":{"version":"5.1.1","time":"2023-10-18T20:45:49.906Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <noscript>
        <style>
            .honkit-cloak {
                display: block !important;
            }
        </style>
    </noscript>
    <script>
        // Restore sidebar state as critical path for prevent layout shift
        function __init__getSidebarState(defaultValue){
            var baseKey = "";
            var key = baseKey + ":sidebar";
            try {
                var value = localStorage[key];
                if (value === undefined) {
                    return defaultValue;
                }
                var parsed = JSON.parse(value);
                return parsed == null ? defaultValue : parsed;
            } catch (e) {
                return defaultValue;
            }
        }
        function __init__restoreLastSidebarState() {
            var isMobile = window.matchMedia("(max-width: 600px)").matches;
            if (isMobile) {
                // Init last state if not mobile
                return;
            }
            var sidebarState = __init__getSidebarState(true);
            var book = document.querySelector(".book");
            // Show sidebar if it enabled
            if (sidebarState && book) {
                book.classList.add("without-animation", "with-summary");
            }
        }

        try {
            __init__restoreLastSidebarState();
        } finally {
            var book = document.querySelector(".book");
            book.classList.remove("honkit-cloak");
        }
    </script>
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-livereload/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

